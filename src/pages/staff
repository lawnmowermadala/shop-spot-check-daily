'use client'
import { createClient } from '@/utils/supabase/client'
import { useState, useEffect } from 'react'
import { Button } from '@/components/ui/button'
import { Input } from '@/components/ui/input'
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select'

export default function StaffPage() {
  const [name, setName] = useState('')
  const [departmentId, setDepartmentId] = useState('')
  const [departments, setDepartments] = useState<any[]>([])
  const supabase = createClient()

  useEffect(() => {
    const fetchDepartments = async () => {
      const { data, error } = await supabase
        .from('departments')
        .select('*')
      
      if (error) {
        console.error('Error fetching departments:', error)
      } else {
        setDepartments(data || [])
      }
    }
    fetchDepartments()
  }, [])

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    
    const { data, error } = await supabase
      .from('staff')
      .insert([{ 
        name, 
        department_id: departmentId 
      }])
      .select()

    if (error) {
      alert(`Error: ${error.message}`)
    } else {
      alert('Staff member added successfully!')
      setName('')
      setDepartmentId('')
    }
  }

  return (
    <div className="p-4">
      <h1 className="text-2xl font-bold mb-4">Add Staff Member</h1>
      <form onSubmit={handleSubmit} className="space-y-4">
        <div>
          <Input
            type="text"
            placeholder="Staff Name"
            value={name}
            onChange={(e) => setName(e.target.value)}
            required
          />
        </div>
        <div>
          <Select 
            value={departmentId} 
            onValueChange={setDepartmentId}
            required
          >
            <SelectTrigger>
              <SelectValue placeholder="Select Department" />
            </SelectTrigger>
            <SelectContent>
              {departments.map((dept) => (
                <SelectItem key={dept.id} value={dept.id}>
                  {dept.name}
                </SelectItem>
              ))}
            </SelectContent>
          </Select>
        </div>
        <Button type="submit">Add Staff</Button>
      </form>
    </div>
  )
}
